<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes"><!-- iOS 주소창 없앰 -->
    <title>땡큐베리머치</title>
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="header_area">
                <button type="button" class="btn pr-10">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1>견적서 등록&수정</h1>
            </div>
            <div class="header_area">
                <button type="button" class="btn btn_fill btn_save">저장</button>
            </div>
        </header>
        <div class="body edit">
            <div class="card">
                <button class="btn card_header" onclick="delivery_detail_toggle(this);">
                    <div class="title">납품 요청자 정보</div>
                    <span class="material-symbols-outlined icon">keyboard_arrow_up</span>
                </button>
                <div class="card_body">
                    <div class="detail_item baseline">
                        <label class="title">이름</label>
                        <div class="value">
                            <div class="thx_value_readonly">[점주] 안산역1호점</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">연락처</label>
                        <div class="value">
                            <div class="thx_value_readonly">010-7777-8888</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <button class="btn card_header" onclick="delivery_detail_toggle(this);">
                    <div class="title">공급 업체 정보</div>
                    <span class="material-symbols-outlined icon">keyboard_arrow_up</span>
                </button>
                <div class="card_body">
                    <div class="detail_item">
                        <label class="title">업체 사업자등록번호</label>
                        <div class="value">
                            <div class="thx_value_readonly">87-152-14521</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item baseline">
                        <label class="title">업체명</label>
                        <div class="value">
                            <div class="thx_value_readonly">아남전자</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">업체 대표자명</label>
                        <div class="value">
                            <div class="thx_value_readonly">이겨례</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item baseline">
                        <label class="title">업체 주소</label>
                        <div class="value">
                            <div class="thx_value_readonly">경기도 안산시 한겨레빛고을아름다운로 52길 100</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">업체 업태</label>
                        <div class="value">
                            <div class="thx_value_readonly">서비스</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">업체 종목</label>
                        <div class="value">
                            <div class="thx_value_readonly">상품권 발행</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">업체 담당자명</label>
                        <div class="value">
                            <div class="thx_value_readonly">홍길동</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item">
                        <label class="title">업체 담당자 연락처</label>
                        <div class="value">
                            <div class="thx_value_readonly">01077778888</div>
                        </div>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item start">
                        <label for="floor_plan" class="title required">업체 담당자 서명</label>
                        <div class="value">
                            <div class="input_wrap">
                                <div class="thumbnail_add_file wrap_company_manager_cert">
                                    <button class="btn btn_pop_signature"></button>
                                    <!--image will be inserted here-->
                                </div>
                                <div class="guide"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <button class="btn card_header" onclick="delivery_detail_toggle(this);">
                    <div class="title">납품 품목 정보</div>
                    <span class="material-symbols-outlined icon">keyboard_arrow_up</span>
                </button>
                <div class="card_body">
                    <div class="detail_item vertical">
                        <label class="title required">납품 품목</label>

                        <ul class="delivery_item_list">
                            <li>
                                <button class="btn btn_delete_delivery_item" onclick="delete_delivery_item(this)">
                                    <span class="material-symbols-outlined icon">remove</span>
                                </button>
                                <div class="item ml-10">
                                    <div class="item_info">
                                        <span class="d-inline-block">가전제품</span>
                                        <span class="d-inline-block">에어컨</span>
                                        <span class="d-inline-block">엘지휘센2024MV</span>
                                    </div>
                                    <div class="quotation_each_total_delivery_item d-between-center mt-5">
                                        <span>총액</span>
                                        <span>110,000원</span>
                                    </div>
                                    <div class="d-between-center mt-5">
                                        <span>단가</span>
                                        <span>10,000</span>
                                    </div>
                                    <div class="d-between-center mt-5">
                                        <span>수량</span>
                                        <span>10</span>
                                    </div>
                                    <div class="d-between-center mt-5">
                                        <span>단위</span>
                                        <span>EA</span>
                                    </div>
                                    <div class="d-between-center mt-5">
                                        <span>부가세</span>
                                        <span>별도(10%)</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        <div class="pt-10"></div>
                        <div class="quotation_total_delivery_item">
                            <span>합계</span>
                            <span>220,000원</span>
                        </div>

                        <button class="btn btn_add_delivery_item">
                            <div class="d-center">
                                <span class="icon mr-10">
                                    <span class="material-symbols-outlined">add</span>
                                </span>
                                <span>납품 품목 추가</span>
                            </div>
                        </button>
                    </div>
                    <div class="pt-10"></div>
                    <div class="detail_item vertical">
                        <label class="title">비고</label>
                        <div class="input_wrap w-100">
                            <div class="p-relative">
                                <textarea class="thx_txt righticon delivery_quotation_etc" id="delivery_quotation_etc"
                                    name="" placeholder="내용을 입력하세요." autocomplete="off" required value=""></textarea>
                                <div class="input_icon_wrap"></div>
                            </div>
                            <div class="guide"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 견적서 납품 품목 추가 -->
    <div class="bottomSheetContainer" id="add_delivery_item" data-type="bottom">
        <div class="bottomSheet">
            <button class="btn handle" onclick="$('#add_delivery_item').sheet('hide');"><span></span></button>
            <div class="bottomSheet_header">
                <div class="title">견적서 납품 품목 추가</div>
            </div>
            <div class="pt-10 mt-10"></div>
            <div class="bottomSheet_body">
                <div class="input_wrap w-100">
                    <div class="thx_select_box">
                        <select name="" id="" class="thx_select">
                            <option>종목을 선택하세요</option>
                            <option value="">가전</option>
                            <option value="">오디오</option>
                        </select>
                    </div>
                </div>
                <div class="pt-10"></div>
                <div class="input_wrap w-100">
                    <div class="thx_select_box">
                        <select name="" id="" class="thx_select">
                            <option>품목을 선택하세요</option>
                            <option value="">에어컨</option>
                            <option value="">TV</option>
                        </select>
                    </div>
                </div>
                <div class="pt-10"></div>
                <div class="input_wrap w-100">
                    <div class="thx_select_box">
                        <select name="" id="" class="thx_select">
                            <option>모델을 선택하세요</option>
                            <option value="">LG 휘센 M60</option>
                            <option value="">LG 휘센 M80</option>
                        </select>
                    </div>
                </div>
                <div class="pt-10"></div>
                <div class="detail_item">
                    <label class="title">수량</label>
                    <div class="value">
                        <div class="d-flex-grow-1 d-center">
                            <button class="btn btn_delivery_count minus">
                                <span class="material-symbols-outlined">remove</span>
                            </button>
                            <input type="text" id="" class="thx_txt text-align-center input_delivery_count" name=""
                                value="7" readonly />
                            <button class="btn btn_delivery_count plus">
                                <span class="material-symbols-outlined">add</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="pt-10"></div>
                <div class="detail_item start">
                    <label class="title">단가</label>
                    <div class="value">
                        <div class="input_wrap w-100">
                            <div class="p-relative input_won">
                                <input type="tel" class="thx_txt rightdoubleicon" id="unit_price" name=""
                                    placeholder="금액을 입력하세요" autocomplete="off" required
                                    onkeyup="inputNumberFormat(this);">
                                <div class="input_icon_wrap"></div>
                            </div>
                            <div class="guide"></div>
                        </div>
                    </div>
                </div>
                <div class="pt-10"></div>
                <div class="detail_item" style="align-items:flex-start;">
                    <label class="title">부가세</label>
                    <div class="value">
                        <div class="input_wrap">
                            <div class="d-inline-center">
                                <input type="radio" name="surtax" id="surtax_yes"
                                    class="thx_radio vertical-align-middle" checked />
                                <label for="surtax_yes" class="ml-5 vertical-align-middle">부가세 별도</label>
                            </div>
                            <div class="d-inline-center ml-10">
                                <input type="radio" name="surtax" id="surtax_no"
                                    class="thx_radio vertical-align-middle" />
                                <label for="surtax_no" class="ml-5 vertical-align-middle">부가세 없음</label>
                            </div>
                            <div class="guide"></div>
                        </div>
                    </div>
                </div>
                <div class="d-center mt-16 pt-16 pb-16">
                    <button class="btn btn_txt">초기화</button>
                    <button class="btn btn_fill">적용</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 업체 담당자 서명 -->
    <div class="bottomSheetContainer" id="bottomsheet_company_manager_cert" data-type="bottom">
        <div class="bottomSheet">
            <button class="btn handle"
                onclick="$('#bottomsheet_company_manager_cert').sheet('hide');"><span></span></button>
            <div class="bottomSheet_header">
                <div class="title">업체 담당자 서명</div>
            </div>
            <div class="pt-10 mt-10"></div>
            <div class="bottomSheet_body">
                <div class="wrap_canvas" id="wrap_canvas_company_manager_cert">
                    <canvas></canvas>
                </div>
                <div class="d-center mt-16 pt-16 pb-16">
                    <button class="btn btn_txt btn_init_signature">초기화</button>
                    <button class="btn btn_fill btn_apply_signature ml-10">적용</button>
                </div>
            </div>
        </div>
    </div>

    <div class="loading_wrap">
        <div class="spinner-border big"></div>
    </div>

    <script src="../../js/jquery-3.7.1.min.js"></script>
    <script src="../../js/jquery-ui.js"></script>
    <script src="../../js/jquery.ui.touch-punch.min.js"></script>
    <script src="../../js/hammer.min.js"></script>
    <script src="../../js/common.js"></script>
    <script>
        $(function () {
            initData();
            initEventListener();
        });

        function initData() {

        }

        function initEventListener() {

        }

        /* 전체 페이지의 모든 외부 리소스와 이미지가 브라우저에 불려진 후 로딩 감추기 */
        $(window).on('load', function () {
            $('.loading_wrap').hide();
        });
    </script>
    <script>
        /* 기타 요청사항 입력 초기화 */
        var inputWithReset_delivery_quotation_etc = new InputWithReset('#delivery_quotation_etc');

        /* 견적서 납품 품목 추가 팝업 띄우기 */
        $('.btn_add_delivery_item').on('click', function (event) {
            $('#add_delivery_item').sheet('show');
        });



        /* 납품 품목 추가 */
        var delivery_item = `
                <li>
                    <button class="btn btn_delete_delivery_item" onclick="delete_delivery_item(this)">
                        <span class="material-symbols-outlined icon">remove</span>
                    </button>
                    <div class="item ml-10">
                        <div class="item_info">
                            <span class="d-inline-block">가전제품</span>
                            <span class="d-inline-block">에어컨</span>
                            <span class="d-inline-block">엘지휘센2024MV</span>
                        </div>
                        <div class="quotation_each_total_delivery_item d-between-center mt-5">
                            <span>총액</span>
                            <span>110,000원</span>
                        </div>
                        <div class="d-between-center mt-5">
                            <span>단가</span>
                            <span>10,000</span>
                        </div>
                        <div class="d-between-center mt-5">
                            <span>수량</span>
                            <span>10</span>
                        </div>
                        <div class="d-between-center mt-5">
                            <span>단위</span>
                            <span>EA</span>
                        </div>
                        <div class="d-between-center mt-5">
                            <span>부가세</span>
                            <span>별도(10%)</span>
                        </div>
                    </div>
                </li>
            `;
        /* $('.btn_add_delivery_item').on('click', function () {
            $('.delivery_item_list').append(delivery_item);
        }); */
        /* 납품 품목 삭제 */
        function delete_delivery_item(element) {
            $(element).parent()[0].remove();
        }

        /* 접었다 펼쳤다 */
        function delivery_detail_toggle(element) {
            var card_header = $(element);
            var card_body = $($(element).siblings()[0]);
            card_header.toggleClass('hide');
            card_body.toggleClass('hide');
        }


    </script>
    <script>
        $('.btn_pop_signature').on('click', function () {    // 업체 담당자 서명 플러스 버튼
            $('#bottomsheet_company_manager_cert').sheet('show');
            $('#wrap_canvas_company_manager_cert').delete_signature();
            $('#wrap_canvas_company_manager_cert').draw_signature();
        });

        $('.btn_init_signature').on('click', function () {  // 서명 팝업 초기화 버튼
            $('#wrap_canvas_company_manager_cert').delete_signature();
        });

        function isCanvasCleared(canvas) {
            var context = canvas.getContext('2d', { willReadFrequently: true });
            var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
            // 캔버스의 모든 픽셀값이 0이면 클리어된 것으로 간주
            for (var i = 0; i < imgData.data.length; i++) {
                if (imgData.data[i] !== 0) {
                    // 픽셀값이 0이 아닌 것이 발견되면 클리어되지 않은 것으로 간주
                    return false;
                }
            }
            // 모든 픽셀값이 0이면 클리어된 것으로 간주
            return true;
        }
        $('.btn_apply_signature').on('click', function () { // 서명 팝업 적용 버튼
            var canvas = $('#wrap_canvas_company_manager_cert canvas')[0];
            if (isCanvasCleared(canvas)) {
                $.modal('show', {
                    message: `서명난이 비었습니다.`,
                    onebutton: `<button class="btn btn_fill" onclick="$.modal('hide')">확인</button>`,
                });
            } else {
                $('#wrap_canvas_company_manager_cert').make_signature_data({ container: '.wrap_company_manager_cert', btn_open: '.btn_pop_signature' });
                $('#wrap_canvas_company_manager_cert').delete_signature();
                $('#bottomsheet_company_manager_cert').sheet('hide');
            }
        });

        $('.btn_delivery_count').on('click', function (event) {
            /* 대기번호 총 갯수 플러스 마이너스 버튼 */
            var _this = $(event.currentTarget);
            var input_delivery_count = $('.input_delivery_count');
            if (_this.hasClass('minus')) {
                if (input_delivery_count.val() > 1) {
                    input_delivery_count.val(parseInt(input_delivery_count.val(), 10) - 1);
                }
            } else if (_this.hasClass('plus')) {
                if (input_delivery_count.val() < 21) {
                    input_delivery_count.val(parseInt(input_delivery_count.val(), 10) + 1);
                }
            }
        });

        /* 단가 입력 초기화 */
        var inputWithReset_unit_price = new InputWithReset('#unit_price');
        var str;
        function comma(str) {
            if (str === '') {
                return '';
            }
            str = parseInt(str);
            str = str.toLocaleString(); // 천단위 콤마
            return str;
        }

        function uncomma(str) {
            str = String(str);
            return str.replace(/[^\d]+/g, ''); // 숫자 외에는 지운다.
        }

        function inputNumberFormat(obj) {
            str = obj.value;
            obj.value = comma(uncomma(str));
        }

        /* 납품 품목 추가 */
        $('#add_delivery_item').sheet('show');

        /* 업체 담당자 서명 */
        //$('#bottomsheet_company_manager_cert').sheet('show');
    </script>
</body>

</html>